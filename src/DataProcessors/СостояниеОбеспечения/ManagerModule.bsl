#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ПрограммныйИнтерфейс

Процедура ЗаполнитьВариантОбеспечения(Объект, Форма, ДанныеЗаполнения, ДатаОтгрузки = Неопределено) Экспорт

	СоСклада = Перечисления.ВариантыОбеспечения.СоСклада;

	ТекСтрокаТовары = Неопределено;
	Идентификатор   = Неопределено;
	Для Каждого СтрокаОбеспечения Из ДанныеЗаполнения Цикл

		//Выбор существующей, либо добавление новой строки.
		Если Идентификатор <> СтрокаОбеспечения.Идентификатор Тогда
			Идентификатор = СтрокаОбеспечения.Идентификатор;
			СтрокаТовары = Объект.ТаблицаЗаказа.НайтиПоИдентификатору(Идентификатор);
			ТекСтрокаТовары = СтрокаТовары;
		Иначе
			ТекСтрокаТовары = Объект.ТаблицаЗаказа.Вставить(Объект.ТаблицаЗаказа.Индекс(ТекСтрокаТовары) + 1);
			ЗаполнитьЗначенияСвойств(ТекСтрокаТовары, СтрокаТовары);
			ТекСтрокаТовары.КодСтроки = 0;
		КонецЕсли;

		//Заполнение полей обеспечения.
		ЗаполнитьЗначенияСвойств(ТекСтрокаТовары, СтрокаОбеспечения, "Количество, ВариантОбеспечения, Склад");
		ТекСтрокаТовары.Модифицирована = Истина;

		ДатаПоУмолчанию = Макс(НачалоДня(ТекущаяДата()), ТекСтрокаТовары.ЖелаемаяДатаОтгрузки);
		Если ДатаОтгрузки <> Неопределено Тогда
			ДатаПоУмолчанию = Макс(ДатаПоУмолчанию, ДатаОтгрузки);
		КонецЕсли;

		Если СтрокаОбеспечения.Отгружено = 0 Тогда
			ТекСтрокаТовары.ДатаОтгрузки = Макс(СтрокаОбеспечения.ДатаОтгрузки, ДатаПоУмолчанию);
		КонецЕсли;

	КонецЦикла;

КонецПроцедуры

#КонецОбласти

#КонецЕсли
